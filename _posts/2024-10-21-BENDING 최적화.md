---
title: Log 남기기
categories:
  - DEVELOPMENT
tags:
  - 최적화
  - Bending
  - AutoRouting
use_math: true
---
프로그램에서 BENDING 구간에서 BENDING을 만들기 위한 길이를 확보하지 못하는 경우가 발생할 수 있습니다.  
(하나의 BENDING(90° 엘보)을 생성하기 위해서는 1.5 * OD 만큼의 길이가 필요합니다.  
OD = 배관의 외경)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjimuhu-V3gykZGnRyJws7DXqJQt9TdquzgFIfTuTgxz-NQ2Ycw2RyjScRVeFv1LnZzxdIu5YSfN9BXpPbTcQOBDLMkkuK4hseljnmCZfN0u0MytlTV7BAlTDpS-VojJu-LbtnofzqDoQcAWCA3bnITzDcs9QHDmkD4HdI0X29f1A_e8tJLM1zD53p2ODI/s1600/Pasted%20image%2020240924221005.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjimuhu-V3gykZGnRyJws7DXqJQt9TdquzgFIfTuTgxz-NQ2Ycw2RyjScRVeFv1LnZzxdIu5YSfN9BXpPbTcQOBDLMkkuK4hseljnmCZfN0u0MytlTV7BAlTDpS-VojJu-LbtnofzqDoQcAWCA3bnITzDcs9QHDmkD4HdI0X29f1A_e8tJLM1zD53p2ODI/s172/Pasted%20image%2020240924221005.png)

충분한 길이를 확보하지 못하는 경우 배관 모델링에서 오류가 발생합니다.  
오류를 수정하기 위해서  
라우팅을 끝내고 BENDING 길이를 확보하지 못한 구간을 찾아 보정하는 것이 필요합니다.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1qkWzw0i8pKUtAtHXhzZb7Qoho6wJXsrv4NJS3cjyvkuPKUUoGmxvdwacuxtn4CA3WYqrzsN9AqGkUBv2mJ4rKGBdWshJLN9nfZwKSs-K6cCTwq6bmRy-kXulR1SZE3d0e-VzegxWskrffPO6Z7FGFl4wsTSAGVplAVLrYkf-uzkNYwSe1yAXowFGXvU/s320/Pasted%20image%2020240923093212.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1qkWzw0i8pKUtAtHXhzZb7Qoho6wJXsrv4NJS3cjyvkuPKUUoGmxvdwacuxtn4CA3WYqrzsN9AqGkUBv2mJ4rKGBdWshJLN9nfZwKSs-K6cCTwq6bmRy-kXulR1SZE3d0e-VzegxWskrffPO6Z7FGFl4wsTSAGVplAVLrYkf-uzkNYwSe1yAXowFGXvU/s419/Pasted%20image%2020240923093212.png)
  
2번째 구간의 경우 앞, 뒤로 BENDING(1-2, 2-3)이 발생합니다.  
따라서 양쪽에 90° 엘보를 사용했을 때 최소 **3 * OD** (1.5 * OD + 1.5 * OD)의 길이가 필요합니다.  
필요 길이를 확보하지 못하는 경우에 구간을 삭제하거나 사용하는 엘보의 변경이 필요합니다.  
아래는 사용하는 엘보에 대한 Factor입니다.  
  
| Elbow     | Factor |
| --------- | ------ |
| 90° Elbow | 1.5    |
| 60° Elbow | 1.06   |
| 45° Elbow | 0.62   |
| 30° Elbow | 0.18   |
  
먼저 구간 삭제에 대해서 알아보기로 하겠습니다.  
위 그림에서 2번 구간을 삭제하면 인접한 1 혹은 3번을 이동하면 될 것 같습니다.  
1번의 이동은 경로의 시작 점이 변경되기 때문에 이동하면 안되고 3번을 이동하면 아래와 같이 됩니다.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhS6BHJLrVty4eIJwfGdky4NyWpEqFS1vGXQTq5Pb49DrrW7szBJgHKWKkgZFbtpQpmoVkzwjipWQrhyphenhyphenVCN3CPSAwqr_8Dc82FpIevNnsR20EGFWReLp26hac2reuHYjKiIe8o54Snui-SLP59f-Nx3EPsLb8Vc447VisPuUrEIFicPUMgcsni5GI_qQaw/s320/Pasted%20image%2020240924080705.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhS6BHJLrVty4eIJwfGdky4NyWpEqFS1vGXQTq5Pb49DrrW7szBJgHKWKkgZFbtpQpmoVkzwjipWQrhyphenhyphenVCN3CPSAwqr_8Dc82FpIevNnsR20EGFWReLp26hac2reuHYjKiIe8o54Snui-SLP59f-Nx3EPsLb8Vc447VisPuUrEIFicPUMgcsni5GI_qQaw/s416/Pasted%20image%2020240924080705.png)

일반화시켜 정리하면 아래와 같습니다.  
- BENDING 길이를 확보하지 못한 구간과 이 구간을 시작과 끝으로 하는 인접한 2개의 구간이 한 평면에 놓여 있을 때 BENDING 길이를 확보하지 못한 구간을 삭제합니다.  
다만 아래 3가지 조건을 만족해야 합니다.  
이후 BENDING 길이를 확보하지 못한 구간을 P, 인접한 구간을 Q, R 이라고 하고 반대편으로 인접한 구간을 O라고 합니다. 그리고 Q를 수정하여 P를 삭제합니다.  

1. P, Q, R 모두 파이프입니다.
2. P, Q, R이 한 평면 상에 존재하고 O-P, P-Q, Q-R은 서로 수직입니다.
3. O과 Q가 수직인 경우
	1. P와 R이 같은 방향이면 P를 삭제할 수 있습니다.
	2. P와 R이 다른 방향
		1. R의 길이가 P의 길이보다 3 * OD보다 커야 합니다.(가장 긴 90° 엘보 2개를 사용한다 가정)
4. O와 Q가 서로 평행할 때
	1. 위 2-1, 2-2 조건을 만족해야 합니다.
	2. O와 Q가 같은 방향이면 P를 삭제할 수 있습니다.
	3. O와 Q가 다른 방향
		1. Q과 O의 길이가 같거나 차이가 3 * OD보다 커야 합니다.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiclNpXoLjw0ltoL2zhU54VjypjDhj4hq-GY0F6FL2gZ950aILc8grro7UP2WIHWhu6IKWr2ON1Fp54lV9FjNiGf7xXZRMq489HGBZ2iQGW50_M9JiefTP3GNdb6wXWW1Usf3hV4-tVMTchWTeG2oT9SIqGIzfs1766wQW7LJ8nYxkAK-5u6Ywy1Qvj2zg/w640-h502/Pasted%20image%2020240924220829.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiclNpXoLjw0ltoL2zhU54VjypjDhj4hq-GY0F6FL2gZ950aILc8grro7UP2WIHWhu6IKWr2ON1Fp54lV9FjNiGf7xXZRMq489HGBZ2iQGW50_M9JiefTP3GNdb6wXWW1Usf3hV4-tVMTchWTeG2oT9SIqGIzfs1766wQW7LJ8nYxkAK-5u6Ywy1Qvj2zg/s799/Pasted%20image%2020240924220829.png)

아래는 가상 코드입니다.  

```csharp
bool RemovePath(P, Q, R, O)
{
	bool res = false;
	
	var plane = new Plane(P,Q,R);
	if(O.AreParallel(plane.Norm))
	{
		if(P.AreCoinsident(R))
		{
			Q.Translate(-P);
			R.Extend(-P);
			delete P;
			
 			res = true;			
		}
		else if(P.AreOpposite(R) && (R.Len > P.Len + TwoBendingSize))
		{
			Q.Translate(-P);
			R.Extend(-P);
			delete P;
			
			res = true;
		}
	}
	else
	{
		if(O.AreCoincident(Q))
		{
			Q.Translate(-P);
			R.Extend(-P);
			delete P;
			
			res = true;
		}
		else if(O.AreOpposite(Q) && Q.Len > O.Len + TwoBendingSize)
		{
			Q.Extend(-O);
			delete P;
			
			res = true;		
		}
	}
	
 	return res;
}

bool AdjustPath()
{
	bool res = false;
	
	for(int i = 0;i < path.Count;++i)
	{
		if(path[i].HasShortThenMinLength)
		{
			if(i - 2 >= 0 && i + 1 < path.Count && IsRemovable(i, i - 1, i- 2, i + 1))			{
				bool adjusted = RemovePath(i, i-1, i-2);				
				if(adjusted)
				{
					res = true;
					break;
				}
			}
			else if(i + 1 < path.Count && i - 1 >= 0 && IsRemovable(i, i + 1, i + 2, i - 1))			
			{
				bool adjusted = RemovePath(i, i+1, i+2);				
				if(adjusted)
				{
					res = true;
					break;
				}
			}
		}
	}
	
	return res;
}
```

위 로직으로도 BENDING 길이를 확보하지 못한 구간이 있는 경우에는 90° 엘보를 사용하지 않고 60°, 45°, 30°의 같은 엘보 2개를 사용하여 필요 BENDING 길이를 줄일 수 있습니다.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg20DFgIX5eeZB21itR1umy54xBbr-rCPPD7CDA-ZunKsuvxhF8PL37SUuNt1xQnMMv7qRD7d3ZPpHQp1Oer_ZZfuvRpnWetqieOc7COmClLx1OUEMZsxp10MzgKpYizC2DPi-ZHR_azPf_k0cmggibr7ybj7zegPuSF-G0t5upsRKcq5yUTJ6VGjBgqMU/w640-h226/Pasted%20image%2020240923224238.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg20DFgIX5eeZB21itR1umy54xBbr-rCPPD7CDA-ZunKsuvxhF8PL37SUuNt1xQnMMv7qRD7d3ZPpHQp1Oer_ZZfuvRpnWetqieOc7COmClLx1OUEMZsxp10MzgKpYizC2DPi-ZHR_azPf_k0cmggibr7ybj7zegPuSF-G0t5upsRKcq5yUTJ6VGjBgqMU/s984/Pasted%20image%2020240923224238.png)

이때 m < 0 이면 45° 엘보 2개를 생성할 길이가 되지 않아 45° 엘보로 변환할 수 없습니다.

위 Factor 와 각도에 대해 일반화 시키면 아래와 같습니다.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgT-SVoshOPVMRbrF0GCjjAWh_mEhtVCt4wrz9a83fMof8nbG2EJjPvpLPkH2cMf5cGDrkEoGLCASc0gI6bCp5c5-ycb8O3BASjuNdfV9Ct3ryyqcjuj3mM7Mvqdy20DA5pZRwCQBCMfo1lcdrCI2OjBioIVfnnvkuWlCdqZgESPykpoM_S0T3jvnUEN6Y/w640-h314/Pasted%20image%2020240923224207.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgT-SVoshOPVMRbrF0GCjjAWh_mEhtVCt4wrz9a83fMof8nbG2EJjPvpLPkH2cMf5cGDrkEoGLCASc0gI6bCp5c5-ycb8O3BASjuNdfV9Ct3ryyqcjuj3mM7Mvqdy20DA5pZRwCQBCMfo1lcdrCI2OjBioIVfnnvkuWlCdqZgESPykpoM_S0T3jvnUEN6Y/s656/Pasted%20image%2020240923224207.png)

여기서 θ는 90°, 60°, 45°, 30°가 될 수 있습니다.  
아래 조건을 만족해야만 θ° 엘보로 변경할 수 있습니다.  
1. 구간 1과 구간 3이 서로 반대 방향이 아니어야 합니다.  
2. m >= 0 이어야 합니다.  
3. 3의 구간은 n + Factor * OD보다 커야 합니다  
아래는 가상 코드입니다.  

```csharp
bool AdjustElbow()
{
	bool res = false;
	
	for(int i = 0;i < path.Count;++i)
	{
		if(path[i].HasShortLength)
		{
			double L = path[i].Length;
			double theta = 60;
			double factor = 1.06;
			double m = L/sin(theta) - 2 * factor * OD;
			double n = L/sin(theta)*sin(theta);
			
			if(m >= 0 && ((i + 1) < path.Count && path[i+1].Length > n * factor * OD))
			{
				ReplaceElbow(theta);
				--i;
				res = true;
				contine;
			}
			
			theta = 45;
			factor = 0.62;
			m = L/sin(theta) - 2 * factor * OD;
			n = L/sin(theta)*sin(theta);
			if(m >= 0 && ((i + 1) < path.Count && path[i+1].Length > n * factor * OD))
			{
				ReplaceElbow(theta);
				--i;
				res = true;
				contine;
			}
			
			theta = 30;
			factor = 0.18;
			m = L/sin(theta) - 2 * factor * OD;
			n = L/sin(theta)*sin(theta);
			if(m >= 0 && ((i + 1) < path.Count && path[i+1].Length > n * factor * OD))
			{
				ReplaceElbow(theta);
				--i;
				res = true;
				contine;
			}
		}
	}
	
 	return res;
}
```

구간 삭제와 엘보 변경을 묶어 코드로 정리하면 아래와 같습니다.  

```csharp
bool adjusted = false;
do
{
	adjusted = AdjustPath();
}while(adjusted);

do
{
	adjusted = AdjustElbow();
}while(adjusted);
```

### 적용 사례

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiG43uQqTOcL_OOHcMIaqlFNT5JMmIFmrlH6Q7vCL_0xr6OTtZ5FFHVEWml2RSPDsJoXG7ytWPkQgV1Nyf0CsKafRLosAg9QGJ87TlL02deGrMb9E61T0nrw9HERtgOZi37LNt7PRl9VuU7aNyRpEY93V5O1mvJTqpkuenwamq3NZqFm98IVXlFQX25AfQ/w640-h618/Pasted%20image%2020240924154155.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiG43uQqTOcL_OOHcMIaqlFNT5JMmIFmrlH6Q7vCL_0xr6OTtZ5FFHVEWml2RSPDsJoXG7ytWPkQgV1Nyf0CsKafRLosAg9QGJ87TlL02deGrMb9E61T0nrw9HERtgOZi37LNt7PRl9VuU7aNyRpEY93V5O1mvJTqpkuenwamq3NZqFm98IVXlFQX25AfQ/s825/Pasted%20image%2020240924154155.png)